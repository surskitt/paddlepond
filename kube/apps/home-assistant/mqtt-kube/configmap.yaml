---
apiVersion: v1
kind: ConfigMap
metadata:
  name: mqtt-kube-config
  namespace: home-assistant
data:
  config.yaml: |
    mqtt:
      host: mosquitto
      port: 1883
      client-id: mqtt-kube
      topic-prefix: mqtt-kube

    http:
      host: 0.0.0.0
      port: 8080
      max-connections: 10

    logging:
      level: DEBUG

    bindings:
      - namespace: media
        resource: Deployment
        name: calibre-web

        patch:
          - topic: calibre-web/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: calibre-web/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: flood

        patch:
          - topic: flood/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: flood/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: jackett

        patch:
          - topic: jackett/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: jackett/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: komga

        patch:
          - topic: komga/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: komga/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: mylar

        patch:
          - topic: mylar/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: mylar/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: nzbget

        patch:
          - topic: nzbget/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: nzbget/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: plex

        patch:
          - topic: plex/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: plex/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: pyload

        patch:
          - topic: pyload/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: pyload/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: radarr

        patch:
          - topic: radarr/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: radarr/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: sonarr

        patch:
          - topic: sonarr/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: sonarr/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: media
        resource: Deployment
        name: transmission

        patch:
          - topic: transmission/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: transmission/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"

      - namespace: restic
        resource: deployment
        name: restic-rest-server-nfs

        patch:
          - topic: resticnfs/power/set
            locus: "spec.replicas"
            values:
              map:
                "ON": 1
                "OFF": 0

        watch:
          - locus: "status.availableReplicas"
            topic: resticnfs/power/state
            retain: true
            qos: 1
            values:
              map:
                1: "ON"
                ~: "OFF"
